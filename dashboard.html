<!DOCTYPE html>  
<html lang="en">  

<head>  
    <title>Dashboard</title>  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <meta charset="UTF-8">  
    <link rel="stylesheet" href="styles.css">  
    <script src="particles.js"></script>  
    <link rel="stylesheet"   
          href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/fontawesome.min.css">  
    <script type="module" src="dashboard.js" defer></script>  
</head>  

<body>  
    <section>  
        <div id="particles-js" class="image"></div>  

        <div class="dashboard-container">  
            <div id="emotion-section" style="text-align: center; padding: 20px;">  
                <h3>Emotion Detection</h3>  
                <video id="webcam" autoplay playsinline width="640" height="480" style="border: 2px solid #ddd;"></video>  
                <canvas id="overlay" style="display: none;"></canvas>  
                <p id="emotionDisplay" style="font-size: 24px; color: #333; margin-top: 10px;">Detected Emotion: None</p>  
                <div class="emotion-suggestion">  
                    <h4>Suggested Activities:</h4>  
                    <ul id="suggestions">  
                        <li>Take deep breaths</li>  
                        <li>Listen to calming music</li>  
                        <li>Take a short walk</li>  
                    </ul>  
                </div>  

                <!-- Music Player Section -->  
                <!--   
                <div id="music-player-section" style="display: none;">  
                    <h2 id="songTitle">Song: None</h2>  
                    <p id="moodDisplay">Mood: None</p>  
                    <audio id="musicPlayer" controls>  
                        <source id="musicSource" src="" type="audio/mpeg">  
                        Your browser does not support the audio element.  
                    </audio>  
                </div>   
                End of Music Player Section -->  
            </div>  

            <div class="welcome-section" style="text-align: center; padding: 20px;">  
                <h1>Welcome to Your Dashboard</h1>  
                <p id="userEmail"></p>  
                <div id="motivationalQuotes" class="dashboard-feature">  
                    <h3>Today's Motivation</h3>  
                    <div id="quoteText" class="quote-text"></div>  
                </div>  
            </div>  

            <div class="dashboard-grid">  
                <div class="dashboard-card todo-card">  
                    <h2>To-Do List</h2>  
                    <div class="todo-content">  
                        <a href="https://aiman020507.github.io/todolist/" target="_blank" class="feature-link">  
                            <i class="fas fa-tasks"></i>  
                            Open To-Do List  
                        </a>  
                    </div>  
                </div>  

                <div class="dashboard-card calendar-card">  
                    <h2>Academic Calendar</h2>  
                    <div class="academic-calendar">  
                        <a href="https://amd.utm.my/academic-calendar/" target="_blank" class="feature-link">  
                            <i class="fas fa-calendar"></i>  
                            View Academic Calendar  
                        </a>  
                    </div>  
                </div>  

                <div class="dashboard-card confession-card">  
                    <h2>Confessions</h2>  
                    <div class="confession-section">  
                        <a href="https://confession2utm.netlify.app/" target="_blank">  
                            <button class="confession-btn">Go to Confessions</button>  
                        </a>  
                    </div>  
                </div>  

                <div class="dashboard-card quizizz-card">  
                    <h2>Quizizz</h2>  
                    <div class="quizizz-section">  
                        <p>Test your knowledge</p>  
                        <a href="https://quizizz.com/join?gc=50706992" target="_blank">  
                            <button class="quiz-btn">Start Quiz</button>  
                        </a>  
                    </div>  
                </div>  

                <div class="dashboard-card links-card">  
                    <h2>Quick Links</h2>  
                    <div class="links-section">  
                        <a href="https://github.com/features/copilot" target="_blank" class="quick-link">  
                            <i class="fas fa-code"></i>  
                            CoPilot  
                        </a>  
                        <a href="https://quillbot.com/" target="_blank" class="quick-link">  
                            <i class="fas fa-sync"></i>  
                            QuillBot  
                        </a>  
                        <a href="https://www.canva.com/" target="_blank" class="quick-link">  
                            <i class="fas fa-palette"></i>  
                            Canva  
                        </a>  
                        <a href="https://www.youtube.com/" target="_blank" class="quick-link">  
                            <i class="fab fa-youtube"></i>  
                            YouTube  
                        </a>  
                    </div>  
                </div>  
            </div>  

            <button onclick="logout()" class="logout-btn">Logout</button>  
        </div>  
    </section>  

    <script>  
        particlesJS("particles-js", {  
            particles: {  
                number: { value: 180, density: { enable: true, value_area: 800 } },  
                color: { value: "#ff6600" },  
                shape: {  
                    type: "circle",  
                    stroke: { width: 5, color: "#FFFF" },  
                    polygon: { nb_sides: 5 },  
                    image: { src: "https://en.wikipedia.org/wiki/Image#/media/File:Image_created_with_a_mobile_phone.png", width: 100, height: 100 }  
                },  
                opacity: {  
                    value: 0.5,  
                    random: false,  
                    anim: { enable: false, speed: 1, opacity_min: 0.1, sync: false }  
                },  
                size: {  
                    value: 3,  
                    random: true,  
                    anim: { enable: false, speed: 40, size_min: 0.1, sync: false }  
                },  
                line_linked: { enable: true, distance: 150, color: "#ff6600", opacity: 0.4, width: 2 },  
                move: {  
                    enable: true,  
                    speed: 6,  
                    direction: "none",  
                    random: false,  
                    straight: false,  
                    out_mode: "out",  
                    bounce: false,  
                    attract: { enable: false, rotateX: 600, rotateY: 1200 }  
                }  
            },  
            interactivity: {  
                detect_on: "canvas",  
                events: {  
                    onhover: { enable: true, mode: "repulse" },  
                    onclick: { enable: true, mode: "push" },  
                    resize: true  
                },  
                modes: {  
                    grab: { distance: 400, line_linked: { opacity: 1 } },  
                    bubble: { distance: 400, size: 40, duration: 2, opacity: 8, speed: 3 },  
                    repulse: { distance: 200, duration: 0.4 },  
                    push: { particles_nb: 4 },  
                    remove: { particles_nb: 2 }  
                }  
            },  
            retina_detect: true  
        });  

        document.addEventListener('DOMContentLoaded', function() {  
            // Motivational Quotes  
            const quotes = [  
                "Success is not final, failure is not fatal: it is the courage to continue that counts.",  
                "The future belongs to those who believe in the beauty of their dreams.",  
                "Don't watch the clock; do what it does. Keep going.",  
                "Believe you can and you're halfway there.",  
                "The only way to do great work is to love what you do.",  
                "Your time is limited, don't waste it living someone else's life.",  
                "Everything you've ever wanted is on the other side of fear.",  
                "Success usually comes to those who are too busy to be looking for it.",  
                "The harder you work for something, the greater you'll feel when you achieve it.",  
                "Dream big and dare to fail."  
            ];  

            function changeQuote() {  
                const quoteText = document.getElementById('quoteText');  
                if (quoteText) {  
                    const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];  
                    quoteText.innerHTML = randomQuote;  
                    console.log('Quote changed to:', randomQuote); // Debug line  
                } else {  
                    console.log('Quote element not found'); // Debug line  
                }  
            }  

            // Change quote every 10 seconds  
            setInterval(changeQuote, 10000);  
            changeQuote();  

            // Start webcam for emotion detection  
            startWebcam();  
        });  

        // Webcam and Emotion Detection  
        const video = document.getElementById('webcam');  
        const canvas = document.getElementById('overlay');  
        const ctx = canvas.getContext('2d');  

        // Set video dimensions  
        video.width = 640;  
        video.height = 480;  
        canvas.width = 640;  
        canvas.height = 480;  

        // Function to start webcam with error handling  
        async function startWebcam() {  
            try {  
                const stream = await navigator.mediaDevices.getUserMedia({  
                    video: {  
                        width: 640,  
                        height: 480,  
                        facingMode: 'user' // Use front camera  
                    }  
                });  
                video.srcObject = stream;  
                video.onloadedmetadata = () => {  
                    video.play();  
                    // Start capturing frames after video is ready  
                    setInterval(captureFrame, 1000);  
                };  
            } catch (error) {  
                console.error('Error accessing webcam:', error);  
                document.getElementById('emotionDisplay').innerHTML =  
                    'Error: Unable to access webcam. Please make sure you have granted camera permissions.';  
            }  
        }  

        // Function to capture and process frame  
        function captureFrame() {  
            if (video.readyState === video.HAVE_ENOUGH_DATA) {  
                // Draw video frame to canvas  
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);  
                const imageData = canvas.toDataURL('image/jpeg', 0.8);  

                // Send to backend  
                fetch('https://concrete-conversely-parakeet.ngrok.app/predict', {  
                    method: 'POST',  
                    headers: {  
                        'Content-Type': 'application/json',  
                    },  
                    body: JSON.stringify({  
                        image: imageData.split(',')[1]  
                    }),  
                })  
                .then(response => {  
                    if (!response.ok) throw new Error('Network response was not ok');  
                    return response.json();  
                })  
                .then(result => {  
                    document.getElementById('emotionDisplay').innerHTML =  
                        `Detected Emotion: <span>${result.emotion || 'None'}</span>`;  
                    updateSuggestions(result.emotion);  
                    // playSongBasedOnEmotion(result.emotion); // Call to play song based on detected emotion  
                })  
                .catch(error => {  
                    console.error('Error:', error);  
                    document.getElementById('emotionDisplay').innerHTML =  
                        'Error: Could not detect emotion. Please check your connection.';  
                });  
            }  
        }  

        // Function to update suggestions based on emotion  
        function updateSuggestions(emotion) {  
            const suggestions = document.getElementById('suggestions');  
            const suggestionsList = {  
                happy: [  
                    'Share your joy with others',  
                    'Take a selfie',  
                    'Listen to upbeat music'  
                ],  
                sad: [  
                    'Take deep breaths',  
                    'Listen to calming music',  
                    'Talk to a friend'  
                ],  
                angry: [  
                    'Practice deep breathing',  
                    'Take a short walk',  
                    'Count to ten slowly'  
                ],  
                neutral: [  
                    'Set a goal for today',  
                    'Do some light stretching',  
                    'Plan your next activity'  
                ]  
            };  

            const currentSuggestions = suggestionsList[emotion?.toLowerCase()] || [  
                'Take deep breaths',  
                'Listen to calming music',  
                'Take a short walk'  
            ];  

            suggestions.innerHTML = currentSuggestions  
                .map(suggestion => `<li>${suggestion}</li>`)  
                .join('');  
        }  

        // Logout function  
        function logout() {  
            // Implement your logout logic here  
            alert('You have logged out.');  
        }  
    </script>  
    <script src="js/todo.js"></script>  
</body>  

</html>